"use strict";(self.webpackChunkgreenfield_docs=self.webpackChunkgreenfield_docs||[]).push([[9296],{7451:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>l,contentTitle:()=>n,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var i=t(87462),r=(t(67294),t(3905));const s={title:"SP Common Issues",order:5},n=void 0,a={unversionedId:"guide/storage-provider/run-book/common-issues",id:"guide/storage-provider/run-book/common-issues",title:"SP Common Issues",description:"This is a list of solutions to common SP deployment issues",source:"@site/docs/guide/storage-provider/run-book/common-issues.md",sourceDirName:"guide/storage-provider/run-book",slug:"/guide/storage-provider/run-book/common-issues",permalink:"/greenfield-docs/docs/guide/storage-provider/run-book/common-issues",draft:!1,editUrl:"https://github.com/bnb-chain/greenfield-docs/blob/main/docs/guide/storage-provider/run-book/common-issues.md",tags:[],version:"current",frontMatter:{title:"SP Common Issues",order:5},sidebar:"guideSidebar",previous:{title:"SP Config",permalink:"/greenfield-docs/docs/guide/storage-provider/run-book/config"},next:{title:"Overview",permalink:"/greenfield-docs/docs/guide/dapp/overview"}},l={},d=[{value:"Create Storage Provider Proposal Failed",id:"create-storage-provider-proposal-failed",level:2},{value:"Address not found issue",id:"address-not-found-issue",level:2},{value:"Description",id:"description",level:3},{value:"Root Cause",id:"root-cause",level:3},{value:"Solution",id:"solution",level:3},{value:"Database Configuration Issue",id:"database-configuration-issue",level:2},{value:"Description",id:"description-1",level:3},{value:"Root Cause",id:"root-cause-1",level:3},{value:"Solution",id:"solution-1",level:3},{value:"Object Sealed State Issue",id:"object-sealed-state-issue",level:2},{value:"Description",id:"description-2",level:3},{value:"Root Cause",id:"root-cause-2",level:3},{value:"Solution",id:"solution-2",level:3},{value:"P2P Issue",id:"p2p-issue",level:2},{value:"Description:",id:"description-3",level:3},{value:"Root Cause",id:"root-cause-3",level:3},{value:"Solution",id:"solution-3",level:3},{value:"Minio Authentication Issue",id:"minio-authentication-issue",level:2},{value:"Description",id:"description-4",level:3},{value:"Root Cause",id:"root-cause-4",level:3},{value:"Solution",id:"solution-4",level:3}],p={toc:d},c="wrapper";function u(e){let{components:o,...t}=e;return(0,r.kt)(c,(0,i.Z)({},p,t,{components:o,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This is a list of solutions to common SP deployment issues"),(0,r.kt)("h2",{id:"create-storage-provider-proposal-failed"},"Create Storage Provider Proposal Failed"),(0,r.kt)("p",null,"Examples: ",(0,r.kt)("a",{parentName:"p",href:"https://greenfieldscan.com/proposal/4"},"here")," and ",(0,r.kt)("a",{parentName:"p",href:"https://greenfieldscan.com/proposal/31"},"here")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reason 1: The proposal initiator address does not have balance of ",(0,r.kt)("strong",{parentName:"li"},"1k BNB")," as deposit"),(0,r.kt)("li",{parentName:"ul"},"Reason 2: The proposal initiator address does not grant gov module to spend 1k BNB, as instructed ",(0,r.kt)("a",{parentName:"li",href:"https://docs.bnbchain.org/greenfield-docs/docs/guide/storage-provider/run-book/run-testnet-SP-node#1-authorization"},"here"))),(0,r.kt)("h2",{id:"address-not-found-issue"},"Address not found issue"),(0,r.kt)("h3",{id:"description"},"Description"),(0,r.kt)("p",null,"After starting SP binary, see the following error:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'rpc error: code = NotFound desc = rpc error: code = NotFound desc = account 0x12334567890 not found: key not found"\n')),(0,r.kt)("h3",{id:"root-cause"},"Root Cause"),(0,r.kt)("p",null,"It's not possiible to find information about a newly created address on chain."),(0,r.kt)("h3",{id:"solution"},"Solution"),(0,r.kt)("p",null,"Before starting your SP, transfer BNB to all of your 5 addresses."),(0,r.kt)("h2",{id:"database-configuration-issue"},"Database Configuration Issue"),(0,r.kt)("h3",{id:"description-1"},"Description"),(0,r.kt)("p",null,"After starting SP binary, see the following error"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'Table "block_syncer.master_db" does not exist\nFailed to get db config from config file\n')),(0,r.kt)("h3",{id:"root-cause-1"},"Root Cause"),(0,r.kt)("p",null,"Data source name(dsn) is not set in ",(0,r.kt)("inlineCode",{parentName:"p"},"config.toml"),"."),(0,r.kt)("h3",{id:"solution-1"},"Solution"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[BlockSyncer]\nModules = ['epoch','bucket','object','payment','group','permission','storage_provider','prefix_tree']\nDsn = [BsDB_User]:[BsDB_Passwd]@tcp([BsDB_Address])/[BsDB_Database?parseTime=true&multiStatements=true&loc=Local\n")),(0,r.kt)("h2",{id:"object-sealed-state-issue"},"Object Sealed State Issue"),(0,r.kt)("h3",{id:"description-2"},"Description"),(0,r.kt)("p",null,"After uploading a file, you see an error message:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Message: object has not been sealed state\n")),(0,r.kt)("p",null,"From SP log, you see the following"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{"t":"2023-07-10T11:34:50.856+0800","l":"error","caller":"gfspapp/sign_server.go:42","msg":"failed to seal object","error":"code_space:\\"signer\\" http_status_code:400 inner_code:120002 description:\\"failed to broadcast seal object tx, error: failed to broadcast tx, resp code: 13\\" "}\n')),(0,r.kt)("h3",{id:"root-cause-2"},"Root Cause"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Seal address")," does not have enough BNB to sign seal transactions"),(0,r.kt)("h3",{id:"solution-2"},"Solution"),(0,r.kt)("p",null,"transfer BNB to Seal address"),(0,r.kt)("h2",{id:"p2p-issue"},"P2P Issue"),(0,r.kt)("h3",{id:"description-3"},"Description:"),(0,r.kt)("p",null,"After uploading a file, you see an error message:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{"t":"2023-07-05T10:22:37.365Z","I":"warn","caller":"p2pnode/node.go:223","msg":"failed to get sufficient approvals","task_key":"ReplicatePieceApproval-bucketimage-1-object:OAT.png-id:215241","expect":6,"accepted":0} {"t":"2023-07-05T10:22:37.365Z","I":"error","caller":"p2p/p2p_task.go:39","msg":"failed to get sufficient approvals as secondary sp","task_key":"ReplicatePieceApproval-bucketimage-1-object:OAT.png-id:215241","accept":0,"min":6,"max":6} {"t":"2023-07-05T10:22:37.365Z","I":"error","caller":"gfspapp/p2p_server.go:29","msg":"failed to get replicate piece approval from p2p","task_key":"ReplicatePieceApproval-bucketimage-1-object:OAT.png-id:215241","error":"code_space:rp2pr http_status_code:404 inner_code:70002 description:rinsufficient approvals as secondary spr "} {"t":"2023-07-05T10:22:37.369Z","I":"error","caller":"executor/execute_replicate.go:58","msg":"failed get approvals","task_key":"Replicating-bucketimage-1- object:OAT.png-id:215241","error":"code_space:rp2pr http_status_code:404 inner_code:70002 description:rinsufficient approvals as secondary spr "} {"t":"2023-07-05T10:22:37.376Z","I":"info","caller":"gfspapp/manage_server.go:158","msg":"begin to handle reported task","task_key":"Replicating-bucketimage-1-object:OAT.png-id:215241","task_info":"key[Replicating-bucketimage-1-object:OAT.png-id:215241], type[ReplicatePieceTask], priority[255], limit[memory:25165824 tasks:1 tasks_high_priorityl ], create[1688552547], update[1688552547], timeout[90], retry[1], max_retry[3], runner[127.0.0.1], error[code_space:rp2pr http_status_code:404 inner_code:70002 description:rinsufficient approvals as secondary spr ]"} {"t":"2023-07-05T10:22:37.376Z","I":"error","caller":"manager/manage_task.go:176","msg":"handler error replicate piece task","task_key":"Replicating-bucketimage-1-object:OAT.png-id:215241","task_info":"key[Replicating-bucketimage-1-object:OAT.png-id:215241], type[ReplicatePieceTask], priority[255], limit[memory:25165824 tasks:1 tasks_high_priorityl ], create[1688552547], update[1688552547], timeout[90], retry[1], max_retry[3], runner[127.0.0.1], error[code_space:\\"p2py http_status_code:404 inner_code:70002 description:yinsufficient approvals as secondary spr ]","error":"code_space:rp2pr http_status_code:404 inner_code:70002 description:rinsufficient approvals as secondary spr "}\n\n')),(0,r.kt)("h3",{id:"root-cause-3"},"Root Cause"),(0,r.kt)("p",null,"SP is not connected with other SPs in P2P network"),(0,r.kt)("h3",{id:"solution-3"},"Solution"),(0,r.kt)("p",null,"check ","[P2P]"," setting in ",(0,r.kt)("inlineCode",{parentName:"p"},"config.toml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[P2P]\n# p2p node msg Secp256k1 encryption key, it is different from other SP's addresses\nP2PPrivateKey = '${p2p_private_key}'\nP2PAddress = '0.0.0.0:9933'\nP2PAntAddress = '${load_balance_doamin:port}'\nP2PBootstrap = [\"16Uiu2HAkvgrSt4oUNZ8rWe2qpimLDajyqD6Ca7LV7n9FkzzPNDQh@k8s-gftestne-p2pexter-bc25ac70bc-a31e9596d87054c3.elb.us-east-1.amazonaws.com:9933\"]\nP2PPingPeriod = 0\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"P2PAntAddress")," is your load balance address. If you don't have a load balance address, you should have a public IP and use it in ",(0,r.kt)("inlineCode",{parentName:"p"},"P2PAddress"),".\n",(0,r.kt)("inlineCode",{parentName:"p"},"P2PBootstrap")," consists of ",(0,r.kt)("inlineCode",{parentName:"p"},"[node_id1@ip1:port1, node_id2@ip1:port2]"),", you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"P2PAntAddress")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"P2PAddress")," as ",(0,r.kt)("inlineCode",{parentName:"p"},"ip:port"),". Public node is: ",(0,r.kt)("inlineCode",{parentName:"p"},"16Uiu2HAkvgrSt4oUNZ8rWe2qpimLDajyqD6Ca7LV7n9FkzzPNDQh@k8s-gftestne-p2pexter-bc25ac70bc-a31e9596d87054c3.elb.us-east-1.amazonaws.com:9933")),(0,r.kt)("h2",{id:"minio-authentication-issue"},"Minio Authentication Issue"),(0,r.kt)("h3",{id:"description-4"},"Description"),(0,r.kt)("p",null,"Cannot config Minio as storage"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{"t":"2023-07-17T18:05:40.245+0800","l":"debug","caller":"storage/object_storage.go:15","msg":"created minio storage at endpoint http://172.17.0.2:9000/hashquark"}\nJul 17 18:05:41 10-7-46-85 gnfd-sp[18585]: {"t":"2023-07-17T18:05:40.245+0800","l":"info","caller":"storage/minio.go:37","msg":"new minio store succeeds","bucket":"hashquark"}\nJul 17 18:07:01 10-7-46-85 gnfd-sp[18585]: {"t":"2023-07-17T18:07:00.893+0800","l":"error","caller":"storage/s3.go:147","msg":"S3 failed to head bucket","error":"NoCredentialProviders: no valid providers in chain. Deprecated.\\n\\tFor verbose messaging see aws.Config.CredentialsChainVerboseErrors"}\nJul 17 18:07:01 10-7-46-85 gnfd-sp[18585]: {"t":"2023-07-17T18:07:00.893+0800","l":"error","caller":"piece/piece_store.go:88","msg":"failed to head bucket","error":"NoCredentialProviders: no valid providers in chain. Deprecated.\\n\\tFor verbose messaging see aws.Config.CredentialsChainVerboseErrors"}\nJul 17 18:07:01 10-7-46-85 gnfd-sp[18585]: {"t":"2023-07-17T18:07:00.893+0800","l":"error","caller":"piece/piece_store.go:77","msg":"failed to check bucket due to storage is not configured rightly ","error":"deny access bucket","object":"minio://hashquark/"}\nJul 17 18:07:01 10-7-46-85 gnfd-sp[18585]: {"t":"2023-07-17T18:07:00.893+0800","l":"error","caller":"piece/piece_store.go:21","msg":"failed to create storage","error":"deny access bucket"}\n')),(0,r.kt)("h3",{id:"root-cause-4"},"Root Cause"),(0,r.kt)("p",null,"This is a Minio authentication"),(0,r.kt)("h3",{id:"solution-4"},"Solution"),(0,r.kt)("p",null,"Set Minio authentication tokens/keys as global variable"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'    // MinioRegion defines env variable name for minio region\n    MinioRegion = "MINIO_REGION"\n    // MinioAccessKey defines env variable name for minio access key\n    MinioAccessKey = "MINIO_ACCESS_KEY"\n    // MinioSecretKey defines env variable name for minio secret key\n    MinioSecretKey = "MINIO_SECRET_KEY"\n    // MinioSessionToken defines env variable name for minio session token\n    MinioSessionToken = "MINIO_SESSION_TOKEN"// MinioRegion defines env variable name for minio region\n    MinioRegion = "MINIO_REGION"\n    // MinioAccessKey defines env variable name for minio access key\n    MinioAccessKey = "MINIO_ACCESS_KEY"\n    // MinioSecretKey defines env variable name for minio secret key\n    MinioSecretKey = "MINIO_SECRET_KEY"\n    // MinioSessionToken defines env variable name for minio session token\n    MinioSessionToken = "MINIO_SESSION_TOKEN"\n')))}u.isMDXComponent=!0}}]);